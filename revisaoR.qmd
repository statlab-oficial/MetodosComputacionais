# Uma pequena introdução ao R


## Introdução {.unnumbered}

O `R` é peça-chave em inúmeros trabalhos de pesquisa e análise de dados porque reúne, de forma prática, um conjunto amplo de técnicas estatísticas atuais, das mais básicas às mais sofisticadas, e facilita seu uso no dia a dia. Quem começa no `R`, porém, muitas vezes também está dando os primeiros passos em programação. Assim, além de aprender as ferramentas do `R` para seus objetivos, é preciso desenvolver a “cabeça” de programador. Essa fase inicial ajuda a explicar a fama de que o `R` é “difícil”. Mesmo assim, com prática e uma boa orientação, ele se revela bem mais acessível do que parece.

## Instalação {.unnumbered}

Este guia mostra como **baixar e instalar o `R` a partir do CRAN** (Comprehensive R Archive Network), com orientações específicas para **Windows**, **macOS** e **Linux**. Ao final, você testará a instalação e configurará um **espelho (mirror) brasileiro** para baixar pacotes mais rápido.

::: callout-note
**O que é o CRAN?**  
É a rede oficial de servidores que distribui o `R` e seus pacotes. Você pode usar o endereço inteligente [https://cloud.r-project.org](https://cloud.r-project.org) ou definir um espelho no Brasil (ex.: C3SL/UFPR).
:::


Você pode simplesmente usar:

- **Cloud CRAN (recomendado):** [https://cloud.r-project.org](https://cloud.r-project.org) (redireciona para um espelho próximo).

- **Brasil (ex.: UFPR/C3SL):** [https://cran-r.c3sl.ufpr.br](https://cran-r.c3sl.ufpr.br)

Mais adiante, mostraremos como fixar o mirror no `R` permanentemente.

### Windows {.unnumbered}

1. Acesse a página **Download `R` for Windows** → **base** e baixe o instalador.

2. Execute o instalador e avance com as opções padrão (recomendado para iniciantes).

3. (Opcional) Se pretende **compilar pacotes a partir do código-fonte**, instale o **Rtools** compatível com a sua versão do `R`.

::: callout-tip
**Rtools:** após instalar, reinicie o R/RStudio. Em geral, o Rtools adiciona as ferramentas ao *PATH* automaticamente.
:::


### macOS {.unnumbered}

1. Acesse **`R` for macOS** no CRAN e baixe o arquivo `.pkg` da versão atual.

2. Abra o `.pkg` e conclua a instalação.

3. (Opcional) Para compilar pacotes, instale também as **Command Line Tools** do Xcode:

```bash
xcode-select --install
``` 

### Linux {.unnumbered}

**Ubuntu/Debian**

Opção rápida (repositório da distribuição):

```
sudo apt update
sudo apt install -y r-base
```

Para obter versões mais novas (repositório do CRAN), siga as instruções do CRAN para adicionar o repositório oficial e então:

```
sudo apt update
sudo apt install -y r-base r-base-dev
```

**Verificar a instalação**

No terminal/Prompt:

```
R --version
R
```

Dentro do R:

```{r}
version
```

Se o `R` abriu no console, a instalação está ok!


**Teste rápido de pacotes**

No R:

```{r}
#install.packages("tidyverse")   # teste de instalação/espelho
library(tidyverse)

tibble(x = 1:5, y = x^2)

```

Se o pacote instalou e carregou sem erros, está tudo certo.

#### Fixar um mirror brasileiro do CRAN {.unnumbered}

Defina o espelho apenas nesta sessão:

```{r}
#| eval: false

options(repos = c(CRAN = "https://cran-r.c3sl.ufpr.br"))
install.packages("ggplot2")
```

Para tornar **permanente**, adicione a linha abaixo ao seu arquivo `~/.Rprofile`:

```{r}
#| eval: false

options(repos = c(CRAN = "https://cloud.r-project.org"))
# ou, se preferir, o espelho da UFPR:
# options(repos = c(CRAN = "https://cran-r.c3sl.ufpr.br"))
```

#### Como editar o `~/.Rprofile` {.unnumbered}

- Linux/macOS:

```
echo 'options(repos = c(CRAN = "https://cloud.r-project.org"))' >> ~/.Rprofile
```

- Windows: o `~` normalmente aponta para `C:\\Users\\SEU_USUARIO\\Documents`.

Você pode criar/editar `C:\\Users\\SEU_USUARIO\\Documents\\.Rprofile` com um editor de texto.


#### (Opcional) IDE recomendada: RStudio {.unnumbered}

Após instalar o `R`, instale o `RStudio Desktop` (Posit) para um ambiente de desenvolvimento mais amigável:

- Criação/edição de scripts

- Gerenciamento de projetos

- Visualização de plots e help integrados

#### Dicas e solução de problemas {.unnumbered}

- **Permissões de administrador:** em ambientes corporativos, pode ser necessário pedir para TI instalar o `R`.

- **Firewall/Proxy:** se a instalação de pacotes falhar, verifique configurações de proxy e tente trocar o mirror.

- **Compatibilidade de versões:** ao compilar pacotes, garanta que as ferramentas (Rtools no Windows; CLT/Xcode no macOS) correspondam à sua versão do `R`.

- Atualização do `R`: ao atualizar o `R`, alguns pacotes precisarão ser reinstalados; use `install.packages()` novamente.

- **Testes mínimos:**

```{r}
sessionInfo()
capabilities()  # checa recursos gráficos, etc.
```


## O que é o `R` {.unnumbered}

`R` é uma implementação moderna da linguagem `S`, voltada à computação estatística e à visualização de dados. Ele reúne, no mesmo lugar, um ambiente interativo para análise e criação de gráficos e uma linguagem de programação completa.

::: callout-note
**Em uma frase:** R é um ambiente estatístico + uma linguagem, criada para trabalhar bem com dados, gráficos e métodos modernos.
:::


#### Principais características {.unnumbered}

- **Interativo e interpretado**, com suporte a **JIT/bytecode** via pacote `compiler`.

- **Orientado a objetos** (S3, S4 e R6) e com forte base **funcional**.

- **Modelo “tudo é objeto”**: números, vetores, data frames, funções, ambientes e modelos ajustados.

- **Vetorização nativa** e operações matriciais eficientes.

- **Ecossistema de pacotes** amplo (CRAN, Bioconductor) para estatística e ciência de dados.

- **Extensível** com C/C++/Fortran e integração com Python, SQL e serviços externos.

- **Multiplataforma** (Windows, macOS, Linux) e foco em **reprodutibilidade** (scripts, Quarto/R Markdown).

#### Exemplo - "tudo é objeto"  {.unnumbered}

```{r}
#| label: exemplo-objeto
#| echo: true
#| message: false
#| warning: false

x <- 1:5               # vetor (objeto)
media <- mean(x)       # função aplicada ao objeto

f <- function(z) z^2
classe_f <- class(f)   # "function" — funções também são objetos

attr(x, "nota") <- "exemplo de atributo"
lista <- list(x = x, media = media, classe_f = classe_f)

str(lista)             # inspeciona a estrutura
lista
```


::: callout-tip
Dica: use `str(obj)` para entender a estrutura de qualquer objeto no `R`.

Outras funções úteis: `class()`, `attributes()`, `typeof()`, `methods(class = ...)`.
:::

Aqui vai como mudar o *prompt* do `R` para `R>`, na sessão atual usando:

```{r}
options(prompt = "R> ", continue = "+")
```

Para adicionar comentários no `R`, como você observou nos exemplos acima, basta usar `#`, como no exemplo abaixo:

```{r}
#Este é um comentário! 
#Que o semestre seja leve para todos nós!
```

Uma sessão ativa do `R` sempre está “apontando” para um diretório de trabalho. Se você não informar um caminho completo ao salvar ou importar arquivos, o `R` usará esse diretório por padrão. Para descobrir onde ele está:

```{r}
getwd()
```

Se você deseja modificar o diretório de trabalho, isso pode ser feito de maneira simples:

```{r}
#| eval: false

# Windows
setwd("C:/Users/SeuUsuario/Documents/meu-projeto")

# macOS / Linux
setwd("/Users/seuusuario/meu-projeto")

```


O `R` não vem com todos os pacotes adicionais que a comunidade desenvolve. Para usá-los, você precisa baixar e instalar a partir de um repositório, em geral, o CRAN.

```{r}
#| eval: false
# define um espelho (mirror) do CRAN para esta sessão
options(repos = c(CRAN = "https://cloud.r-project.org"))

# instala um ou mais pacotes
install.packages("tidyverse")
install.packages(c("ggplot2", "dplyr", "readr"))

# carrega para usar
library(tidyverse)
```

A instalação pode ser feita também facilmente usando o `RStudio`. 

Pacotes da comunidade são atualizados com frequência para corrigir erros e acrescentar recursos. Periodicamente, vale checar se há novas versões para o que você já tem instalado. A partir do console do `R`, você pode verificar e atualizar com um único comando.

```{r}
#| eval: false

# defina um mirror (opcional, mas recomendável)
options(repos = c(CRAN = "https://cloud.r-project.org"))

# procura versões mais novas e atualiza automaticamente
update.packages(ask = FALSE, checkBuilt = TRUE)
```

- `ask = FALSE` atualiza sem perguntar pacote a pacote.

- `checkBuilt = TRUE` recompila pacotes se sua versão do `R` mudou.

**Ver o que está desatualizado antes:**

```{r}
#| warning: false
#| message: false

old.packages()  # retorna uma tabela com pacotes que têm versão mais nova
```


**Atualizar apenas alguns pacotes:**

```{r}
#| eval: false

update.packages(oldPkgs = c("gamlss", "ggmap"), ask = FALSE)
```


O `R` traz um conjunto amplo de arquivos de ajuda que permitem:

- Buscar funcionalidades por nome ou por tema.

- Entender como usar uma função e quais argumentos ela recebe.

- Esclarecer o papel de cada argumento e o que a função retorna.

- Ver exemplos de uso prontos para rodar.

- Saber como citar o `R`, pacotes e conjuntos de dados em publicações.


Agora iremos ver algumas funções úteis:

- Ajuda com função específica:

```{r}
#| eval: false

?lm # atalho                  

help("lm") #abre a documentação da função

help(package = "stats") # índice de um pacote

```

- Buscar por tema (se você não sabe o nome exato):

```{r}
#| eval: false


??"linear model"        # busca por tópicos
help.search("normal")   # alternativa
apropos("plot")         # lista objetos cujo nome contém "plot"
```

- Ver argumentos e formas de chamada

```{r}
#| eval: false

args(lm)  # nomes dos argumentos (se aplicável)
formals(lm) # valores-padrão dos argumentos
```


- Exemplos, retorno e estrutura

```{r}
#| eval: false

example(lm) # roda os exemplos da ajuda
m <- lm(mpg ~ wt, data = mtcars)
str(m)                  # inspeciona o objeto retornado
methods("predict")      # métodos disponíveis para um genérico

```


- Vignettes (tutoriais)

```{r}
#| eval: false

vignette()  # lista geral
vignette(package = "ggplot2") # vignettes de um pacote
browseVignettes(package = "dplyr")  # abre no navegador
```


- Como citar R/pacotes/dados


```{r}
#| eval: true

citation()  # como citar o R
citation("ggplot2")   # como citar um pacote
toBibtex(citation("ggplot2"))  # em BibTeX 


```


- Conjuntos de dados


```{r}
data() # abre uma lista com os datasets disponíveis

# ?mtcars   # ajuda de um dataset específico
```


Console vs. editor:  Você pode digitar comandos diretamente no console ou escrever um script no editor e então executá-lo. Em materiais didáticos, distinguimos os dois formatos para evitar confusão.

1) Código mostrado com prompt `(R>)` = digitado no console

- Em livros/notas, comandos de console costumam aparecer com o prompt na frente.
Exemplo (divisão de 14 por 6):

```{r}
#| label: console-exemplo
#| eval: false
#| prompt: true
#| comment: NA
options(prompt = "R> ", continue = "+ ")
14/6
```

- Ao copiar para o `R`, remova o `R>`, o console já mostra o seu próprio prompt.

2) Código pensado para script (sem prompt)

- Quando o texto disser “escreva no editor e depois execute”, o código aparece sem `R>`.
Exemplo (laço simples):


```{r}
#| label: loop-no-editor
#| echo: true
for (myitem in 5:7) {
  cat("--INÍCIO DO BLOCO--\n")
  cat("o item atual é", myitem, "\n")
  cat("--FIM DO BLOCO--\n\n")
}
```

> **Dica de estilo:** chaves na mesma linha do for, quebra de linha para o corpo e indentação consistente.

3) Linhas longas: uma linha só ou “quebradas”

- Chamadas extensas podem ficar em uma linha ou ser quebradas em pontos naturais (geralmente após vírgulas ou antes de argumentos nomeados).

- Ao quebrar, alinhe com o parêntese de abertura ou indente um nível.

Uma linha:

```{r}
#| label: linha-unica
#| echo: true
ordfac.vec <- factor(x = c("Small","Large","Large","Regular","Small"),
                     levels = c("Small","Regular","Large"),
                     ordered = TRUE)

```

Quebrada (equivalente, apenas formatação):

```{r}
#| label: linha-quebrada
#| echo: true
ordfac.vec2 <-
  factor(
    x       = c("Small","Large","Large","Regular","Small"),
    levels  = c("Small","Regular","Large"),
    ordered = TRUE
  )
identical(ordfac.vec, ordfac.vec2)

```


##  Números, Aritmética, Atribuição e Vetores  {.unnumbered}

1) Números (*numerics*)

Em `R`, o tipo numérico padrão é **double** (ponto flutuante). Você também pode ter **inteiros** (sufixo `L`) e **complexos**.

```{r}
#| label: numerics-basico
#| echo: true
typeof(1)      # "double"
typeof(1L)     # "integer"
typeof(1+2i)   # "complex
```

- Valores especiais:

```{r}
#| echo: true
1/0  # Inf
-1/0 # -Inf
0/0  # NaN
is.finite(c(Inf, 3.14)) # checa finitude
```


::: callout-tip
Precisão numérica: comparações com `==` podem falhar por arredondamento binário. Prefira `all.equal(x, y)`.
:::

```{r}
#| label: precisao-numerica
#| echo: true
# 1) Exemplo clássico
x <- 0.1 + 0.2
y <- 0.3

x == y                       # pode dar FALSE
identical(x, y)              # compara "bit a bit": quase sempre FALSE aqui

# Ver a diferença real (use mais dígitos)
old <- options(digits = 17)
x; y; x - y                  # diferença minúscula de arredondamento binário
options(old)

# Comparação com tolerância
all.equal(x, y)              # TRUE (dentro da tolerância padrão)
isTRUE(all.equal(x, y))      # retorna um lógico (TRUE/FALSE)

# 2) Outros casos que sofrem com ponto flutuante
sin(pi)                      # ~ 1.224646799e-16 (não é 0 exato)
sin(pi) == 0                 # FALSE
all.equal(sin(pi), 0)        # TRUE

# 3) Ajustando a tolerância manualmente (quando precisar ser mais/menos rígido)
all.equal(x, y, tolerance = 1e-12)  # ainda TRUE
all.equal(x, y, tolerance = 1e-20)  # agora acusa diferença

# 4) Estratégia base sem all.equal: comparar o |erro| com um limite
abs((sqrt(2))^2 - 2) < 1e-12 # TRUE (aceita "igualdade" numérica com folga)

```


2) Aritmética

Operadores básicos: `+ - * / ^` e, ainda, divisão inteira `%/%` e módulo `%%`.


```{r}
#| label: aritmetica
#| echo: true
14/6
14 %/% 6 # quociente inteiro
14 %% 6 # resto
2^3  # potência
```


- Precedência: `^` → `* / %/% %%` → `+ -`. **Use parênteses para deixar claro!**

3) Atribuição

O padrão recomendado é `<-`. `=` também atribui, mas use-o preferencialmente para argumentos de função. `->` é atribuição para a direita. `<<-` afeta o ambiente pai (use com parcimônia).


```{r}
#| label: atribuicao
#| echo: true
x <- 10
y = 5   # ok, mas prefira <- fora de chamadas de função
z <- x + y

z -> resultado  # atribuição para a direita (menos comum)
resultado

# Exemplo de <<- (evite, pode dificultar depuração)
contador <- local({
  n <- 0
  function() { n <<- n + 1; n }
})
contador(); contador(); contador()

```


::: callout-warning
**Boas práticas:** Evite `<<-` sempre que possível; prefira retornar valores e trabalhar com escopos explícitos.
:::

4) Vetores (atômicos)

Vetores são coleções unidimensionais do mesmo tipo: lógico, inteiro, double, caractere, complexo ou raw.

```{r}
#| label: vetores-basico
#| echo: true
v <- c(2, 4, 6, 8)
length(v); typeof(v)

seq(1, 5, by = 2)      # sequência
1:5                    # atalho
rep(3, times = 4)      # repetição
```

- *Coerção automática:* ao misturar tipos, `R` promove para um tipo comum.

```{r}
#| echo: true
c(1, TRUE, "a") # tudo vira character
```

- Indexação e filtragem:

```{r}
#| label: indexacao
#| echo: true
x <- c(10, 20, 30, 40, 50)
x[3]             # posição
x[-1]            # tudo, exceto o 1º
x[x > 25]        # filtragem lógica
which(x > 25)    # posições TRUE
names(x) <- letters[1:5]
x["c"]
```

4.1. Vetorização e reciclagem

A maioria das operações é vetorizada (aplica-se elemento a elemento). Quando os comprimentos diferem, R tenta reciclar o menor vetor.


4.2. Nomes × Objetos e copy-on-modify

```{r}
#| label: copy-on-modify
#| echo: true
x <- 1:3
y <- x
y[1] <- 99
x  # permanece 1 2 3
y  # 99 2 3
```

- Exceção: ambientes e estruturas por referência (p.ex., R6) não seguem copy-on-modify.


### Exercícios  {.unnumbered}

1. Crie um vetor com os números de $5$ a $15$ e calcule a média.

2. Use `seq()` para gerar $0, 0.5, 1,\dots, 5$.

3. Mostre com código a diferença entre `%/%` e `%%` usando 14 e 6.

4. Atribua `x <- 1:4` e some com o vetor `c(10, 20)`. O que acontece?

5. Verifique o tipo de `1`, `1L` e `1+0i`. Explique a diferença entre tipo (typeof) e classe (class).

6. Crie e armazene uma sequência de valores de **5 a −11**, progredindo em **passos de 0.3**.

7. Sobrescreva o objeto de (a) com a mesma sequência invertida.

8. Repita o vetor `c(-1, 3, -5, 7, -9)` duas vezes, com cada elemento repetido 10 vezes.
Apresente os dados ordenados do maior para o menor.

9. Crie e armazene um vetor contendo, em qualquer ordem:

a) inteiros de `6` a `12` (inclusive);

b) `5.3` repetido 3 vezes;

c) o número `−3`;

d) `9` valores iniciando em 102 e terminando em `length(vc)` (do item (8)).

10. Confirme que o comprimento do vetor criado em d) é 20.

<!-- ## Estrutura Lógicas {.unnumbered} -->

<!-- ## Estruturas de Controle {.unnumbered} -->

<!-- ## Funções {.unnumbered} -->

<!-- ## Distribuições de Probabilidade {.unnumbered} -->




